<div class="card card-outline card-primary">
  <div class="card-body">
    <div class="card card-primary">
      <div class="card-header custom-header">
        Schema <span *ngIf="mode == 'new'">Generator</span> <span *ngIf="mode == 'edit'">Editor</span>
        <div class="card-tools">
          <button type="button" class="btn btn-tool" data-card-widget="collapse">
              <i class="fas fa-minus"></i>
          </button>
          <button type="button" class="btn btn-tool" ngbTooltip="Save Schema"  (click)="saveCreatedSchema();">
            <i class="fas fa-save"></i>
          </button>
          <button type="button" class="btn btn-tool" data-card-widget="maximize">
            <i class="fas fa-expand"></i>
          </button>
        </div>
      </div>
      <div class="card-body">
        <div class="row">
          <!-- <div class = "col-md-12 well">
            {{ generatedSchemaList | json}}
          </div> -->
          <div class="col-md-2" *ngIf="mode == 'new'" style="margin-bottom:10px;">
            <label class="label">JSON Data</label>
            <textarea class="col-md-12 form-control" [(ngModel)]="jsonData" style="height:700px;font-size:12px"  (change)="translateTextArea()"></textarea>
          </div>
    
          <div class="col-md-7" *ngIf="currentSchema !== undefined" >
            <label class="label">Schema Name : <span class="badge bg-primary">{{currentSchema.version}}</span></label>
            <input class="form-control form-control-sm" type="text" [(ngModel)]="currentSchema.name">
            <table class="table table-hover">
              <tbody>
                <ng-container *ngFor="let rec of generatedSchemaList">
                  <tr data-widget="expandable-table" aria-expanded="false">
                    <td style="display:inline-flex">
                      <i class="expandable-table-caret fas fa-caret-right fa-fw"></i>
                      <input class="form-control form-control-sm" [(ngModel)]="rec.name" (focus)="this.modelName = rec.name"  (blur)="this.generateDRLModelAfterUpdateRef(rec.name)" type="text" style="margin-left: 20px;">
                    </td>
                    <td><button class="btn btn-xs bg-purple float-right">Add</button></td>
                  </tr>
                  <tr class="expandable-body d-none">
                     <td>
                       <div class="p-0" style="display: none;">
                          <table class="table table-hover">
                            <tr *ngFor="let element of rec.elements">
                              <td> <input class="form-control form-control-sm" [(ngModel)]="element.name" (ngModelChange)="this.generateDRLModel()"></td> 
                              <td>
                                <select class="form-control form-control-sm" [(ngModel)]="element.datatype" (ngModelChange)="this.generateDRLModel()">
                                  <option value="Any">Any</option>
                                  <option value="object">Object</option>
                                  <option value="integer">Integer</option>
                                  <option value="number">Number</option>
                                  <option value="string">String</option>
                                  <option value="boolean">Boolean</option>
                                  <option value="date">Date</option>
                                  <option value="time">Time</option>
                                  <option value="date and time">Date and Time</option>
                                  <option value="date and time duration">Date and Time Duration</option>
                                  <optgroup label="User defined datatype">
                                     <option ngValue="{{schema.name}}" *ngFor="let schema of generatedSchemaList">{{schema.name}}</option>
                                  </optgroup>
                                </select>
                               </td>
                              <td> <div class="form-check">
                                <input class="form-check-input" type="checkbox" [(ngModel)]="element.isList" (ngModelChange)="this.generateDRLModel()">
                                <label class="form-check-label">Array ?</label>
                              </div></td>
                              <td>
                                <a class="btn bg-success btn-xs" (click)="onAddNewElement(rec);">
                                  <i class="fas fa-plus-circle"></i>
                                </a>
                              <a class="btn bg-danger btn-xs" style="margin-left:10px;" (click)="onDeleteElement(rec,element)">
                                <i class="fas fa-times-circle"></i>
                              </a>
                              </td>
                            </tr>
                          </table>
                       </div>
                     </td>
                  </tr>  
                </ng-container>
              </tbody>
              
            </table>
          </div>
          <div class="col-md-3" *ngIf="currentSchema !== undefined">
            <label class="label"> DRL Model </label>
            <div class="col-md-12">
                 <pre><code [highlight]="drlModel" ></code></pre>
            </div>    
          </div>
    
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
      <table class="table table-hover">
        <tbody>
          <ng-container *ngFor="let rec of schemaList">
            <tr data-widget="expandable-table" aria-expanded="false">
              <td>
                <i class="expandable-table-caret fas fa-caret-right fa-fw"></i>
                {{rec.name}}  <span class="badge bg-primary">{{rec.version}}</span>
              </td>
              <td><button class="btn btn-xs bg-purple float-right">Add</button></td>
            </tr>
            <tr class="expandable-body d-none">
               <td>
                 <div class="p-0" style="display: none;">
                    <table class="table table-hover">
                      <tr *ngFor="let element of rec.elements">
                        <td>{{element.name}}</td> 
                        <td>
                          <select class="form-control form-control-sm" [(ngModel)]="element.datatype">
                            <option value="Any">Any</option>
                            <option value="Context">Object</option>
                            <option value="Number">Number</option>
                            <option value="String">String</option>
                            <option value="Boolean">Boolean</option>
                            <option value="Date">Date</option>
                            <option value="Time">Time</option>
                            <option value="Date and Time">Date and Time</option>
                            <option value="Date and Time Duration">Date and Time Duration</option>
                            <optgroup label="User defined datatype">
                               <option value="{{schema}}" *ngFor="let schema of schemaList">{{schema.name}}</option>
                            </optgroup>
                          </select>
                         </td>
                        <td> <div class="form-check">
                          <input class="form-check-input" type="checkbox" [(ngModel)]="element.isList">
                          <label class="form-check-label">Array?</label>
                        </div></td>
                        <td>
                          <a class="btn bg-success btn-xs">
                            <i class="fas fa-plus-circle"></i>
                          </a>
                        <a class="btn bg-danger btn-xs" style="margin-left:10px;">
                          <i class="fas fa-times-circle"></i>
                        </a>
                        </td>
                      </tr>
                    </table>
                 </div>
               </td>
            </tr>  
          </ng-container>
          
        </tbody>  
      </table>
      </div>
    </div>  
  </div>
 </div> 